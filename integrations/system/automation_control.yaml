# Multi-instance control. Defines what instance controls what automations

mqtt:
  select:
    - name: light_controller
      command_topic: "automation_controller/light"
      state_topic: "automation_controller/light"
      retain: true
      icon: "mdi:lightbulb-on"
      options:
        - "none"
        - !secret instance_ip_hams_ns
        - !secret instance_ip_habs_ns

    - name: main_controller
      command_topic: "automation_controller/main"
      state_topic: "automation_controller/main"
      retain: true
      icon: "mdi:gamepad-outline"
      options:
        - "none"
        - !secret instance_ip_hams_ns
        - !secret instance_ip_habs_ns

    - name: sound_controller
      command_topic: "automation_controller/sound"
      state_topic: "automation_controller/sound"
      retain: true
      icon: "mdi:volume-high"
      options:
        - "none"
        - !secret instance_ip_hams_ns
        - !secret instance_ip_habs_ns

    - name: climate_controller
      command_topic: "automation_controller/climate"
      state_topic: "automation_controller/climate"
      retain: true
      icon: "mdi:home-thermometer"
      options:
        - "none"
        - !secret instance_ip_hams_ns
        - !secret instance_ip_habs_ns

template:
  - binary_sensor:
      - default_entity_id: binary_sensor.light_control
        state: >-
          {% set ip = states("sensor.local_ip") %}
          {% if is_state("select.light_controller", ip) -%}
              ON
          {%- else -%}
              OFF
          {%- endif %}
        name: light_control
      - default_entity_id: binary_sensor.main_control
        state: >-
          {% set ip = states("sensor.local_ip") %}
          {% if is_state("select.main_controller", ip) -%}
              ON
          {%- else -%}
              OFF
          {%- endif %}
        name: main_control
      - default_entity_id: binary_sensor.sound_control
        state: >-
          {% set ip = states("sensor.local_ip") %}
          {% if is_state("select.sound_controller", ip) -%}
              ON
          {%- else -%}
              OFF
          {%- endif %}
        name: sound_control
      - default_entity_id: binary_sensor.climate_control
        state: >-
          {% set ip = states("sensor.local_ip") %}
          {% if is_state("select.climate_controller", ip) -%}
              ON
          {%- else -%}
              OFF
          {%- endif %}
        name: climate_control
